<!DOCTYPE html>
<html lang=" en-US ">

<head>
	<meta charset='utf-8'>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/assets/css/style.css?v=78c8719698feee0553096165409216db0a43f06f">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css">

	<style>
		.navbar {
			overflow: hidden;
		}

		.navbar a {
			float: left;
			font-size: 16px;
			color: white;
			padding: 2px 15px;
			text-align: center;
			text-decoration: none;
		}

		.dropdown {
			float: left;
			overflow: hidden;
		}

		.dropdown .dropbtn {
			font-size: 16px;
			border: none;
			outline: none;
			color: white;
			padding: 2px 15px;
			background-color: inherit;
			font-family: inherit;
			margin: 0;
		}

		.navbar a:hover,
		.dropdown:hover .dropbtn {
			background-color: green;
		}

		.dropdown-content {
			display: none;
			position: absolute;
			background-color: #202020;
			min-width: 150px;
			box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
			z-index: 1;
		}

		.dropdown-content a {
			float: none;
			color: white;
			padding: 8px 14px;
			text-decoration: none;
			display: block;
			text-align: left;
		}

		.dropdown-content a:hover {
			background-color: #4666FF;
		}

		.dropdown:hover .dropdown-content {
			display: block;
		}
	</style>

	<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Network Sockets | datdhruvjain.github.io</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Network Sockets" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Interesting learnings on Computer stuff." />
<meta property="og:description" content="Interesting learnings on Computer stuff." />
<link rel="canonical" href="http://192.168.1.117:4000/tools/computer-networks/python-network-sockets.html" />
<meta property="og:url" content="http://192.168.1.117:4000/tools/computer-networks/python-network-sockets.html" />
<meta property="og:site_name" content="datdhruvjain.github.io" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Network Sockets" />
<script type="application/ld+json">
{"@type":"WebPage","url":"http://192.168.1.117:4000/tools/computer-networks/python-network-sockets.html","headline":"Network Sockets","description":"Interesting learnings on Computer stuff.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>

	<header>
		<div class="container">
			<a id="a-title" href="/">
				<h1>datdhruvjain.github.io</h1>
			</a>
			<h2>Interesting learnings on Computer stuff.</h2>

			<!--- need to check what this is all about
		<section id="downloads">
		
		</section>
		--->

			<section class="navbar">


				<!-- THE NON-DROPDOWN MENUS WORK LIKE THIS
				----------------------------------------
				
				<a href="https://datdhruvjain.github.io/directory/file">Title 1</a>
				<a href="./relative-file">Title 2</a>
				<a href="../dir/relative-file-path">Title 3</a>
				<a href="https://datdhruvjain.github.io/blockchain/blockchain">Blockchain</a>

				#	Do Not add add the extention to the file, eg do not put file.md, just file
				---------------------------------------->

				<!-- THE DROPDOWN MENUS WORK LIKE THIS
				----------------------------------------
				
				<div class="dropdown">
					<button class="dropbtn">dropdown-title
						<i class="fa fa-caret-down"></i>
					</button>
					<div class="dropdown-content">
						<a href="https://datdhruvjain.github.io/directory/file">Title 1</a>
						<a href="./relative-file">Title 2</a>
						<a href="../dir/relative-file-path">Title 3</a>
					</div>
				</div>

				#	Do Not add add the extention to the file, eg do not put file.md, just file
				------------------------------------------>

				<a href="/configurations/configurations">My Configs</a>


				<div class="dropdown">
					<button class="dropbtn">Journeys
						<i class="fa fa-caret-down"></i>
					</button>
					<div class="dropdown-content">
						<!--a href="https://datdhruvjain.github.io/journeys/blockchain/blockchain">Blockchain</a-->
						<a href="/journeys/cybersec/cybersec">Cyber Sec</a>
						<a href="/journeys/thm/thm">TryHackMe Journeys</a>
					</div>
				</div>

				<div class="dropdown">
					<button class="dropbtn">Prog Langs
						<i class="fa fa-caret-down"></i>
					</button>
					<div class="dropdown-content">
						<a href="/prog_langs/python/python">Python</a>
						<a href="/prog_langs/cpp/cpp">C++</a>
					</div>
				</div>

				<div class="dropdown">
					<button class="dropbtn">Tools
						<i class="fa fa-caret-down"></i>
					</button>
					<div class="dropdown-content">
						<a href="/tools/git">Git</a>
						<a href="/tools/vim/vim-learnings">Vim</a>
						<a href="/tools/markdown">Markdown</a>
						<a href="/tools/computer-networks/computer-networks">Computer-Networks</a>
					</div>
				</div>


				<!-- add new items from here -->
			</section>

		</div>
	</header>

	<div class="container">
		<section id="main_content">
			<h1 id="network-sockets">Network Sockets</h1>

<h2 id="server-side">Server side</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="n">HEADER</span> <span class="o">=</span> <span class="mi">64</span>
<span class="c1"># Choose a port
</span><span class="n">PORT</span> <span class="o">=</span> <span class="mi">5050</span>
<span class="n">FORMAT</span> <span class="o">=</span> <span class="s">'utf-8'</span>
<span class="n">DISCONNECT_MESSAGE</span> <span class="o">=</span> <span class="s">"!DISCONNECT"</span>

<span class="c1"># Check your ip address using ifconfig/ipconfig/ip addr
# SERVER = "192.168.1.114"
</span>
<span class="c1"># To get based on dynamic hostname
# SERVER = socket.gethostbyname(socket.gethostname())
</span>
<span class="c1"># Symbolic empty string signifies all availiable interfaces
</span><span class="n">SERVER</span> <span class="o">=</span> <span class="s">''</span>

<span class="n">ADDR</span> <span class="o">=</span> <span class="p">(</span><span class="n">SERVER</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>

<span class="c1"># What kind of address are we going to look for in the connections
# SOCK_Stream: Streaming data over the socket
</span><span class="n">server</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="c1"># binds the server to the port. first arguemnt of bind is a tuple
</span><span class="n">server</span><span class="p">.</span><span class="n">bind</span><span class="p">((</span><span class="n">SERVER</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">handle_client</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
    <span class="s">"""
    We are not doing much with the address

    But the object conn of type socket, that is the read deal.
    You see, that is the connection/connected object
    That is like the io stream
    conn.doThis conn.doThat and other shenanigans

    :param conn:
    :param addr:
    :return:
    """</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[NEW CONNECTION] </span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s"> connected."</span><span class="p">)</span>

    <span class="n">connected</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">while</span> <span class="n">connected</span><span class="p">:</span>
        <span class="c1"># Here the first message from the client will always be the length of the header
</span>        <span class="c1"># knock knock protocol
</span>        <span class="n">msg_length</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">HEADER</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">)</span>

        <span class="c1"># The first message comes in as an empty string. (connection succesful msg)
</span>        <span class="c1"># To get around that, we check if the string is empty or not.
</span>        <span class="k">if</span> <span class="n">msg_length</span><span class="p">:</span>
            <span class="n">msg_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg_length</span><span class="p">)</span>

            <span class="c1"># Actual message
</span>            <span class="n">msg</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">msg_length</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">msg</span> <span class="o">==</span> <span class="s">"!DISCONNECT"</span><span class="p">):</span>
                <span class="n">connected</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[</span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s">] </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="n">conn</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"Msg Recv!"</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">))</span>

    <span class="n">conn</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">():</span>
    <span class="s">'''
    Listen is the actual thing that makes our server, "our server"
    That and the server.accept() method
    '''</span>

    <span class="k">print</span><span class="p">(</span><span class="s">"[Starting] server is starting"</span><span class="p">)</span>
    <span class="n">server</span><span class="p">.</span><span class="n">listen</span><span class="p">()</span>

    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[SERVER HAS STARTED] Listening on </span><span class="si">{</span><span class="n">SERVER</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c1"># Wait for new connection
</span>        <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">handle_client</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">addr</span><span class="p">))</span>
        <span class="c1"># Notice that we dont have handle_client() and arguemnts to it are passed by args()
</span>
        <span class="n">thread</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[ACTIVE CONNECTIONS] </span><span class="si">{</span><span class="n">threading</span><span class="p">.</span><span class="n">activeCount</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="n">start</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="client-side">Client side</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">socket</span>

<span class="n">HEADER</span> <span class="o">=</span> <span class="mi">64</span>
<span class="c1"># Choose a port
</span><span class="n">PORT</span> <span class="o">=</span> <span class="mi">5050</span>
<span class="n">FORMAT</span> <span class="o">=</span> <span class="s">'utf-8'</span>
<span class="n">DISCONNECT_MESSAGE</span> <span class="o">=</span> <span class="s">"!DISCONNECT"</span>
<span class="c1"># Check your ip address using ifconfig/ipconfig/ip addr
</span><span class="n">SERVER</span> <span class="o">=</span> <span class="s">"192.168.1.114"</span>
<span class="n">ADDR</span> <span class="o">=</span> <span class="p">(</span><span class="n">SERVER</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">ADDR</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
    <span class="n">msg_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="n">send_length</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg_length</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">)</span>
    <span class="n">send_length</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">' '</span> <span class="o">*</span> <span class="p">(</span><span class="n">HEADER</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">send_length</span><span class="p">))</span>

    <span class="n">client</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">send_length</span><span class="p">)</span>
    <span class="n">client</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">2048</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">))</span>

<span class="n">send</span><span class="p">(</span><span class="s">"Hello world"</span><span class="p">)</span>
<span class="n">send</span><span class="p">(</span><span class="s">"YOLO"</span><span class="p">)</span>
<span class="n">send</span><span class="p">(</span><span class="s">"LALA LAND"</span><span class="p">)</span>
<span class="n">send</span><span class="p">(</span><span class="n">DISCONNECT_MESSAGE</span><span class="p">)</span>
</code></pre></div></div>

		</section>
	</div>
</body>

</html>